<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:MauiApp4.ViewModel"
             x:Class="MauiApp4.ContactsPage"
             Title="ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹">

    <ContentPage.BindingContext>
        <viewmodel:ContactsViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
        <StackLayout Grid.Row="0" Padding="10" Spacing="10">
            <SearchBar Placeholder="ÐŸÐ¾Ð¸ÑÐº ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð²..."
                       Text="{Binding SearchText}"
                       SearchCommand="{Binding SearchContactCommand}"/>

            <Grid ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
                        Command="{Binding LoadContactsCommand}"/>

                <Button Grid.Column="1"
                        Text="+ ÐÐ¾Ð²Ñ‹Ð¹"
                        Command="{Binding AddContactCommand}"/>
            </Grid>
        </StackLayout>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð² -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Contacts}"
                        SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Padding="10" Margin="5" CornerRadius="10">
                        <Grid ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- ÐÐ²Ð°Ñ‚Ð°Ñ€ -->
                            <Frame Grid.Column="0"
                                   WidthRequest="40"
                                   HeightRequest="40"
                                   CornerRadius="20"
                                   BackgroundColor="#512BD4">
                                <Label Text="{Binding FirstName, StringFormat='{0:0}'}"
                                       TextColor="White"
                                       VerticalOptions="Center"
                                       HorizontalOptions="Center"/>
                            </Frame>

                            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ -->
                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="{Binding FirstName}"
                                       FontSize="16"
                                       FontAttributes="Bold"/>
                                <Label Text="{Binding LastName}"
                                       FontSize="14"/>
                                <Label Text="{Binding Phone}"
                                       FontSize="12"
                                       TextColor="Gray"/>
                            </StackLayout>

                            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ -->
                            <StackLayout Grid.Column="2" Orientation="Horizontal">
                                <Button Text="âœï¸"
                                        BackgroundColor="Transparent"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ContactsViewModel}}, Path=EditContactCommand}"
                                        CommandParameter="{Binding .}"/>

                                <Button Text="ðŸ—‘ï¸"
                                        BackgroundColor="Transparent"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:ContactsViewModel}}, Path=DeleteContactCommand}"
                                        CommandParameter="{Binding .}"/>
                            </StackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <!-- ÐŸÑƒÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº -->
            <CollectionView.EmptyView>
                <StackLayout HorizontalOptions="Center"
                             VerticalOptions="Center"
                             Spacing="10">
                    <Label Text="ÐÐµÑ‚ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¾Ð²"
                           FontSize="16"
                           TextColor="Gray"/>
                    <Button Text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
                            Command="{Binding LoadContactsCommand}"/>
                </StackLayout>
            </CollectionView.EmptyView>
        </CollectionView>

        <!-- ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ -->
        <Frame Grid.RowSpan="2"
               IsVisible="{Binding IsModalVisible}"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               Padding="20"
               WidthRequest="300"
               BackgroundColor="White"
               CornerRadius="15">


            <StackLayout Spacing="15">
                <Label Text="{Binding ModalTitle}"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>

                <Entry Placeholder="Ð˜Ð¼Ñ *"
                       Text="{Binding EditingContact.FirstName}"/>

                <Entry Placeholder="Ð¤Ð°Ð¼Ð¸Ð»Ð¸Ñ *"
                       Text="{Binding EditingContact.LastName}"/>

                <Entry Placeholder="Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½"
                       Text="{Binding EditingContact.Phone}"
                       Keyboard="Telephone"/>

                <Entry Placeholder="Email"
                       Text="{Binding EditingContact.Email}"
                       Keyboard="Email"/>

                <Grid ColumnSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Text="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
                            BackgroundColor="#512BD4"
                            TextColor="White"
                            Command="{Binding SaveContactCommand}"/>

                    <Button Grid.Column="1"
                            Text="ÐžÑ‚Ð¼ÐµÐ½Ð°"
                            BackgroundColor="LightGray"
                            Command="{Binding CloseModalCommand}"/>
                </Grid>
            </StackLayout>
        </Frame>

        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <ActivityIndicator Grid.RowSpan="2"
                           IsVisible="{Binding IsBusy}"
                           IsRunning="{Binding IsBusy}"
                           Color="#512BD4"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
    </Grid>
</ContentPage>